# Linux后台运行脚本数据

## screen

screen命令可以实现当前窗口与任务分离，我们即使离线了，服务器仍在后台运行任务。当我们重新登录服务器，可以读取窗口线程，重新连接任务窗口。

### 主要功能

#### 会话回复

只要Screen本身没有终止，在其内部运行的会话都可以恢复。这一点对于远程登录的用户特别有用——即使网络连接中断，用户也不会失去对已经打开的命令行会话的控制。只要再次登录到主机上执行`screen -r`就可以恢复会话的运行。同样在暂时离开的时候，也可以执行分离命令detach，在保证里面的程序正常运行的情况下让Screen挂起（切换到后台）。这一点和图形界面下的VNC很相似。

#### 多窗口

在Screen环境下，所有的会话都独立的运行，并拥有各自的编号、输入、输出和窗口缓存。用户可以通过快捷键在不同的窗口下切换，并可以自由的重定向各个窗口的输入和输出。Screen实现了基本的文本操作，如复制粘贴等；还提供了类似滚动条的功能，可以查看窗口状况的历史记录。窗口还可以被分区和命名，还可以监视后台窗口的活动。

#### 会话共享

Screen可以让一个或多个用户从不同终端多次登录一个会话，并共享会话的所有特性（比如可以看到完全相同的输出）。它同时提供了窗口访问权限的机制，可以对窗口进行密码保护。

### 新建窗口

```
$ screen #这样就可以新建窗口，进入到一个窗口中，但是这样窗口就没有名字，无法区分他们
$ screen -S name #这样新建一个名字为name的窗口，并入到该窗口中
$ screen command 这样新建一个窗口并在窗口中执行command，同样没有名字
```

### 会话分离

我们在一个窗口运行某个程序之后，想退出登录关闭terminal干点别的事，让程序在后台运行。这时就需要和窗口会话分离,有2种方式：

1. 快捷键 Ctrl + a 表示进入命令模式

   Ctrl + a + d 快捷键可以实现分离，这时窗口会弹出[detached]的提示，并回到主窗口。

2. `screen -d name` # 远程detach某个session，前提是已经跳出了`name窗口`

### 恢复会话窗口

```
$ screen -ls #列出窗口列表
$ screen -r 线程名
```

### 杀死会话窗口

```
$ kill -9 threadnum # 例如在上面的2637，kill -9 2637 即可杀死线程，当然就杀死了窗口
```

### 清除死去的窗口

```
$ screen -wipe #自动清除死去的窗口
```

## screen命令说明

```
$ screen [-AmRvx -ls -wipe][-d <作业名称>][-h <行数>][-r <作业名称>][-s <shell>][-S <作业名称>]
```

**参数说明**：

- -A 　将所有的视窗都调整为目前终端机的大小。
- -d<作业名称> 　将指定的screen作业离线。
- -h<行数> 　指定视窗的缓冲区行数。
- -m 　即使目前已在作业中的screen作业，仍强制建立新的screen作业。
- -r<作业名称> 　恢复离线的screen作业。
- -R 　先试图恢复离线的作业。若找不到离线的作业，即建立新的screen作业。
- -s<shell> 　指定建立新视窗时，所要执行的shell。
- -S<作业名称> 　指定screen作业的名称。
- -v 　显示版本信息。
- -x 　恢复之前离线的screen作业。
- -ls或--list 　显示目前所有的screen作业。
- -wipe 　检查目前所有的screen作业，并删除已经无法使用的screen作业

查看当前进程确认脚本是否运行

```
$ ps -ef | grep python3
```

